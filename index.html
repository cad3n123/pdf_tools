<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master PDF Tool</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); display: flex; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; color: #333; }
        .container { background: var(--card); width: 100%; max-width: 600px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* Tabs */
        .tabs { display: flex; background: #e2e8f0; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: 600; color: #64748b; transition: 0.2s; border: none; background: none; outline: none; }
        .tab.active { background: var(--card); color: var(--primary); border-top: 3px solid var(--primary); }
        
        /* Content */
        .content { padding: 30px; display: none; }
        .content.active { display: block; }
        
        h2 { margin-top: 0; }
        p { color: #666; font-size: 0.9em; margin-bottom: 20px; }
        
        /* Inputs & Buttons */
        .drop-zone { border: 2px dashed #cbd5e1; border-radius: 8px; padding: 40px 20px; text-align: center; margin-bottom: 20px; transition: 0.2s; cursor: pointer; }
        .drop-zone:hover { border-color: var(--primary); background: #eff6ff; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; font-weight: 600; transition: 0.2s; }
        .btn:hover { background: #1d4ed8; }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; }
        
        .status { margin-top: 15px; text-align: center; font-size: 0.9em; min-height: 20px; }
        .error { color: #dc2626; }
        .success { color: #16a34a; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab active" onclick="switchTab('combine')">Combine PDFs</button>
        <button class="tab" onclick="switchTab('reverse')">Reverse PDF</button>
        <button class="tab" onclick="switchTab('png')">PDF to PNG</button>
    </div>

    <div id="combine" class="content active">
        <h2>Combine Multiple PDFs</h2>
        <p>Select multiple files. They will be merged in the order selected.</p>
        <div class="drop-zone" onclick="document.getElementById('mergeInput').click()">
            <span id="mergeLabel">Click to select PDFs</span>
            <input type="file" id="mergeInput" multiple accept="application/pdf" style="display:none" onchange="updateLabel('mergeInput', 'mergeLabel')">
        </div>
        <button class="btn" onclick="mergePDFs()">Download Merged PDF</button>
        <div id="mergeStatus" class="status"></div>
    </div>

    <div id="reverse" class="content">
        <h2>Reverse PDF Order</h2>
        <p>Select a single PDF to reverse its page order.</p>
        <div class="drop-zone" onclick="document.getElementById('reverseInput').click()">
            <span id="reverseLabel">Click to select PDF</span>
            <input type="file" id="reverseInput" accept="application/pdf" style="display:none" onchange="updateLabel('reverseInput', 'reverseLabel')">
        </div>
        <button class="btn" onclick="reversePDF()">Download Reversed PDF</button>
        <div id="reverseStatus" class="status"></div>
    </div>

    <div id="png" class="content">
        <h2>Convert PDF to PNGs</h2>
        <p>Converts all pages to images and downloads them as a ZIP.</p>
        <div class="drop-zone" onclick="document.getElementById('pngInput').click()">
            <span id="pngLabel">Click to select PDF</span>
            <input type="file" id="pngInput" accept="application/pdf" style="display:none" onchange="updateLabel('pngInput', 'pngLabel')">
        </div>
        <button class="btn" onclick="pdfToPng()">Convert & Download ZIP</button>
        <div id="pngStatus" class="status"></div>
    </div>
</div>

<script>
    // --- SETUP ---
    // Point PDF.js to the worker on CDN
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    function switchTab(id) {
        document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
        clearStatus();
    }

    function updateLabel(inputId, labelId) {
        const input = document.getElementById(inputId);
        const count = input.files.length;
        document.getElementById(labelId).innerText = count > 0 ? `${count} file(s) selected` : "Click to select";
    }

    function setStatus(id, msg, type) {
        const el = document.getElementById(id);
        el.innerText = msg;
        el.className = 'status ' + type;
    }

    function clearStatus() {
        document.querySelectorAll('.status').forEach(el => el.innerText = '');
    }

    async function readFileAsArrayBuffer(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsArrayBuffer(file);
        });
    }

    // --- LOGIC: MERGE ---
    async function mergePDFs() {
        const files = document.getElementById('mergeInput').files;
        if (files.length === 0) return setStatus('mergeStatus', 'Please select files first.', 'error');
        
        setStatus('mergeStatus', 'Merging...', '');
        try {
            const mergedPdf = await PDFLib.PDFDocument.create();
            for (let file of files) {
                const bytes = await readFileAsArrayBuffer(file);
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                copiedPages.forEach((page) => mergedPdf.addPage(page));
            }
            const pdfBytes = await mergedPdf.save();
            download(pdfBytes, "merged.pdf", "application/pdf");
            setStatus('mergeStatus', 'Done!', 'success');
        } catch (e) {
            setStatus('mergeStatus', 'Error: ' + e.message, 'error');
        }
    }

    // --- LOGIC: REVERSE ---
    async function reversePDF() {
        const file = document.getElementById('reverseInput').files[0];
        if (!file) return setStatus('reverseStatus', 'Please select a file.', 'error');

        setStatus('reverseStatus', 'Processing...', '');
        try {
            const bytes = await readFileAsArrayBuffer(file);
            const pdfDoc = await PDFLib.PDFDocument.load(bytes);
            const pageCount = pdfDoc.getPageCount();
            
            // Create new doc and add pages in reverse
            const newPdf = await PDFLib.PDFDocument.create();
            for (let i = pageCount - 1; i >= 0; i--) {
                const [page] = await newPdf.copyPages(pdfDoc, [i]);
                newPdf.addPage(page);
            }
            
            const pdfBytes = await newPdf.save();
            download(pdfBytes, "reversed.pdf", "application/pdf");
            setStatus('reverseStatus', 'Done!', 'success');
        } catch (e) {
            setStatus('reverseStatus', 'Error: ' + e.message, 'error');
        }
    }

    // --- LOGIC: PDF TO PNG ---
    async function pdfToPng() {
        const file = document.getElementById('pngInput').files[0];
        if (!file) return setStatus('pngStatus', 'Please select a file.', 'error');

        setStatus('pngStatus', 'Converting pages... (this may take a moment)', '');
        
        try {
            const fileData = await readFileAsArrayBuffer(file);
            const pdf = await pdfjsLib.getDocument(fileData).promise;
            const zip = new JSZip();
            
            for (let i = 1; i <= pdf.numPages; i++) {
                setStatus('pngStatus', `Converting page ${i} of ${pdf.numPages}...`, '');
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 }); // High res
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport: viewport }).promise;
                
                // Add to ZIP
                const dataUrl = canvas.toDataURL('image/png');
                const base64Data = dataUrl.replace(/^data:image\/(png|jpg);base64,/, "");
                zip.file(`page_${i}.png`, base64Data, {base64: true});
            }

            setStatus('pngStatus', 'Zipping...', '');
            const content = await zip.generateAsync({type:"blob"});
            download(content, "converted_pages.zip");
            setStatus('pngStatus', 'Done! Check your downloads.', 'success');

        } catch (e) {
            console.error(e);
            setStatus('pngStatus', 'Error. If this persists, try Chrome or Edge.', 'error');
        }
    }
</script>
</body>
</html>